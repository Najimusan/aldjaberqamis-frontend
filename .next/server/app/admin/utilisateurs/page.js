(()=>{var e={};e.id=105,e.ids=[105],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},9666:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var r=s(7096),a=s(6132),i=s(7284),l=s.n(i),n=s(2564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let c=["",{children:["admin",{children:["utilisateurs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4352)),"C:\\Users\\nazim\\Desktop\\aldjaberqamis\\aldjaberqamis-frontend\\app\\admin\\utilisateurs\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2458)),"C:\\Users\\nazim\\Desktop\\aldjaberqamis\\aldjaberqamis-frontend\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,3304)),"C:\\Users\\nazim\\Desktop\\aldjaberqamis\\aldjaberqamis-frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\nazim\\Desktop\\aldjaberqamis\\aldjaberqamis-frontend\\app\\admin\\utilisateurs\\page.tsx"],u="/admin/utilisateurs/page",x={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/utilisateurs/page",pathname:"/admin/utilisateurs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1539:(e,t,s)=>{Promise.resolve().then(s.bind(s,9168))},9168:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>page});var r=s(784),a=s(9885),i=s(7114),l=s(4571),n=s(9803),o=s(1672),c=s(2385),d=s(9518),u=s(5131),x=s(2778),p=s(9494),m=s(6303);let admin_UserManagement=({token:e,onBackToDashboard:t})=>{let[s,i]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[f,y]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[N,v]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[_,q]=(0,a.useState)(1),[C,U]=(0,a.useState)(1),[S,E]=(0,a.useState)({username:"",password:"",role:"manager",profile:{firstName:"",lastName:""}}),P=[{value:"admin",label:"Admin",color:"text-orange-400"},{value:"manager",label:"Manager",color:"text-blue-400"}];(0,a.useEffect)(()=>{fetchUsers()},[f,b,_]);let fetchUsers=async()=>{try{g(!0);let t=new URLSearchParams({page:_.toString(),limit:"10"});f&&t.append("search",f),b&&t.append("role",b);let s=await fetch(`http://localhost:5000/api/users?${t}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){let e=await s.json();i(e.users),U(e.totalPages)}}catch(e){console.error("Erreur lors du chargement des utilisateurs:",e)}finally{g(!1)}},handleCreateUser=async t=>{t.preventDefault();try{let t=await fetch("http://localhost:5000/api/users",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(S)});t.ok&&(v(!1),E({username:"",password:"",role:"client",profile:{firstName:"",lastName:""}}),fetchUsers())}catch(e){console.error("Erreur lors de la cr\xe9ation:",e)}},handleUpdateUser=async t=>{if(t.preventDefault(),w)try{let t=await fetch(`http://localhost:5000/api/users/${w._id}`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(S)});t.ok&&(k(null),E({username:"",password:"",role:"client",profile:{firstName:"",lastName:""}}),fetchUsers())}catch(e){console.error("Erreur lors de la modification:",e)}},handleDeleteUser=async t=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cet utilisateur ?"))try{let s=await fetch(`http://localhost:5000/api/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});s.ok&&fetchUsers()}catch(e){console.error("Erreur lors de la suppression:",e)}},toggleUserStatus=async(t,s)=>{try{let r=await fetch(`http://localhost:5000/api/users/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({isActive:!s})});r.ok&&fetchUsers()}catch(e){console.error("Erreur lors du changement de statut:",e)}},openEditModal=e=>{k(e),E({username:e.username,password:"",role:e.role,profile:{firstName:e.profile?.firstName||"",lastName:e.profile?.lastName||""}})},getRoleColor=e=>{let t=P.find(t=>t.value===e);return t?.color||"text-gray-400"},getRoleLabel=e=>{let t=P.find(t=>t.value===e);return t?.label||e};return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("div",{className:"flex items-center space-x-3",children:t&&(0,r.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t,className:"flex items-center space-x-2 text-gray-300 hover:text-white transition-colors",children:[r.jsx(n.Z,{className:"w-5 h-5"}),r.jsx("span",{children:"Retour au Dashboard"})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx(o.Z,{className:"w-8 h-8 text-white"}),r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion des Utilisateurs"})]}),(0,r.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>v(!0),className:"flex items-center space-x-2 bg-white text-black px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[r.jsx(c.Z,{className:"w-5 h-5"}),r.jsx("span",{children:"Nouvel Utilisateur"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[r.jsx(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:f,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent"})]}),(0,r.jsxs)("select",{value:b,onChange:e=>j(e.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent",children:[r.jsx("option",{value:"",children:"Tous les r\xf4les"}),P.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))]})]}),r.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:h?r.jsx("div",{className:"p-8 text-center text-gray-400",children:"Chargement des utilisateurs..."}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Utilisateur"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"R\xf4le"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date de cr\xe9ation"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-700",children:s.map(e=>(0,r.jsxs)(l.E.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"hover:bg-gray-700 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-600 flex items-center justify-center",children:r.jsx("span",{className:"text-sm font-medium text-white",children:e.profile?.firstName?.[0]||e.username[0].toUpperCase()})})}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-white",children:e.profile?.firstName&&e.profile?.lastName?`${e.profile.firstName} ${e.profile.lastName}`:e.username}),(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:["@",e.username]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getRoleColor(e.role)}`,children:getRoleLabel(e.role)})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("button",{onClick:()=>toggleUserStatus(e._id,e.isActive),className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.isActive?(0,r.jsxs)(r.Fragment,{children:[r.jsx(u.Z,{className:"w-3 h-3 mr-1"}),"Actif"]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(x.Z,{className:"w-3 h-3 mr-1"}),"Inactif"]})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:new Date(e.createdAt).toLocaleDateString("fr-FR")}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[r.jsx(l.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>openEditModal(e),className:"text-blue-400 hover:text-blue-300",children:r.jsx(p.Z,{className:"w-4 h-4"})}),"super_admin"!==e.role?r.jsx(l.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>handleDeleteUser(e._id),className:"text-red-400 hover:text-red-300",children:r.jsx(m.Z,{className:"w-4 h-4"})}):r.jsx(l.E.button,{disabled:!0,className:"text-gray-500 cursor-not-allowed opacity-50",title:"Le Super Admin ne peut pas \xeatre supprim\xe9",children:r.jsx(m.Z,{className:"w-4 h-4"})})]})})]},e._id))})]})})}),C>1&&(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 mt-6",children:[r.jsx("button",{onClick:()=>q(e=>Math.max(e-1,1)),disabled:1===_,className:"px-3 py-2 bg-gray-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Pr\xe9c\xe9dent"}),(0,r.jsxs)("span",{className:"px-4 py-2 text-white",children:["Page ",_," sur ",C]}),r.jsx("button",{onClick:()=>q(e=>Math.min(e+1,C)),disabled:_===C,className:"px-3 py-2 bg-gray-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Suivant"})]}),(N||w)&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 p-6 rounded-lg w-full max-w-md mx-4",children:[r.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:w?"Modifier l'utilisateur":"Nouvel utilisateur"}),(0,r.jsxs)("form",{onSubmit:w?handleUpdateUser:handleCreateUser,children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nom d'utilisateur"}),r.jsx("input",{type:"text",value:S.username,onChange:e=>E({...S,username:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Mot de passe ",w&&"(laisser vide pour ne pas changer)"]}),r.jsx("input",{type:"password",value:S.password,onChange:e=>E({...S,password:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white",required:!w})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"R\xf4le"}),r.jsx("select",{value:S.role,onChange:e=>E({...S,role:e.target.value}),disabled:w?.role==="super_admin",className:`w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white ${w?.role==="super_admin"?"opacity-50 cursor-not-allowed":""}`,children:P.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))}),w?.role==="super_admin"&&r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Le r\xf4le Super Admin ne peut pas \xeatre modifi\xe9"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Pr\xe9nom"}),r.jsx("input",{type:"text",value:S.profile.firstName,onChange:e=>E({...S,profile:{...S.profile,firstName:e.target.value}}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nom"}),r.jsx("input",{type:"text",value:S.profile.lastName,onChange:e=>E({...S,profile:{...S.profile,lastName:e.target.value}}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[r.jsx("button",{type:"button",onClick:()=>{v(!1),k(null),E({username:"",password:"",role:"manager",profile:{firstName:"",lastName:""}})},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500",children:"Annuler"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-white text-black rounded-lg hover:bg-gray-200",children:w?"Modifier":"Cr\xe9er"})]})]})]})})]})},page=()=>{let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)(!0),n=(0,i.useRouter)();return((0,a.useEffect)(()=>{let e=localStorage.getItem("adminToken");if(!e){n.push("/admin/login");return}fetch("http://localhost:5000/api/auth/verify",{headers:{Authorization:`Bearer ${e}`}}).then(e=>{if(e.ok)return e.json();throw Error("Token invalide")}).then(s=>{if("super_admin"!==s.data.user.role){n.push("/admin/dashboard");return}t(e)}).catch(()=>{localStorage.removeItem("adminToken"),n.push("/admin/login")}).finally(()=>{l(!1)})},[n]),s)?r.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:r.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):e?r.jsx(admin_UserManagement,{token:e,onBackToDashboard:()=>n.push("/admin/dashboard")}):null}},4352:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>o});var r=s(5153);let a=(0,r.createProxy)(String.raw`C:\Users\nazim\Desktop\aldjaberqamis\aldjaberqamis-frontend\app\admin\utilisateurs\page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,o=n}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[980,357,626,684,837,245,167],()=>__webpack_exec__(9666));module.exports=s})();